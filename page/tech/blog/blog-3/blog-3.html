
<!doctype html>
<html lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>XD.Wang的技术博客</title>
    <!-- Load CSS -->
    <link href="/assets/tech/css/style.css" rel="stylesheet" type="text/css"/>
    <!-- Load jQuery library -->
    <script type="text/javascript" src="/assets/tech/scripts/jquery-1.6.2.min.js"></script>
    <!-- Load custom js -->
    <script type="text/javascript" src="/assets/tech/scripts/panelslide.js"></script>
    <script type="text/javascript" src="/assets/tech/scripts/custom.js"></script>
    <!-- Load topcontrol js -->
    <script type="text/javascript" src="/assets/tech/scripts/scrolltopcontrol.js"></script>
    <!-- Load NIVO Slider -->
    <link rel="stylesheet" href="/assets/tech/css/nivo-slider.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="/assets/tech/css/nivo-theme.css" type="text/css" media="screen"/>
    <script src="/assets/tech/scripts/jquery.nivo.slider.pack.js" type="text/javascript"></script>
    <script src="/assets/tech/scripts/nivo-options.js" type="text/javascript"></script>
    <!-- Load fancybox -->
    <script type="text/javascript" src="/assets/tech/scripts/jquery.fancybox-1.3.4.pack.js"></script>
    <script type="text/javascript" src="/assets/tech/scripts/jquery.easing-1.3.pack.js"></script>
    <script type="text/javascript" src="/assets/tech/scripts/jquery.mousewheel-3.0.4.pack.js"></script>
    <link rel="stylesheet" href="/assets/tech/css/jquery.fancybox-1.3.4.css" type="text/css" media="screen"/>
</head>
<body>


<input type="hidden" value="BLOG" id="navType">

<!--This is the START of the header-->
<div id="topcontrol" style="position: fixed; bottom: 5px; left: 960px; opacity: 1; cursor: pointer;"
     title="Go to Top"></div>
<div id="header-wrapper">
    <div id="header">
        <div id="logo"><a href="/page/tech/blog-index-1.html"><img src="/assets/tech/images/logo.jpg" width="140"
                                                                   height="70"
                                                                   alt="logo"/></a></div>
        <div id="header-text">
            <h4>技术博客 Code Craft</h4>
            <h6>BLOG</h6>
        </div>
    </div>
</div>
<!--END of header-->
<!--This is the START of the menu-->
<div id="menu-wrapper">
    <div id="main-menu">
        <ul>
            <li><a id="nav-blog" href="/page/tech/blog-index-1.html">博客</a></li>
            <li><a id="nav-note" href="/page/tech/note-index-1.html">笔记</a></li>
            <li><a id="nav-fq" href="/page/tech/faq-index-1.html">问答</a></li>
            <li><a id="nav-digest" href="/page/tech/blog-index-1.html">文摘</a></li>
        </ul>
    </div>
</div>
<!--END of menu-->
<!--This is the START of the segment-->
<div id="content">
    <!--This is the START of the blog section-->
    <div id="blog">
        <div class="blog-item-single">
            <h1>浅谈DNS的工作原理</h1>
            <div class="blog-item-single-info">
                <div class="user">XD.Wang</div>
                <div class="tags">架构</div>
            </div>
            <div class="blog-item-single-content"><a class="single_image" href="/page/tech/pic/dns.jpeg"><img
                    src="/page/tech/pic/dns.jpeg" width="720" height="280" alt="blog1"/></a>
                <div>
                    <h3 style="padding-top: 10px">背景</h3>
                    <hr>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;DNS是每个程序员都听过的一种网络服务，用来解析域名到具体的IP。在大型系统中，DNS服务是比较重要的架构组成，在合适的环节引入DNS服务是架构同学必备的基本功。因此，若要提升自己的架构能力，了解DNS的工作原理是颇为必要的。</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;在讲述DNS的原理之前，有必要先搞清楚为什么需要DNS服务。熟悉网络的同学都知道，现代互联网都建立在TCP/IP网络体系上，机器与机器之间的定位，都需借助IP地址来进行。但在实际情况中，这种毫无规律、不明语义的IP地址非常不利于用户去定位自己要去的网站，有谁能轻易记住10个以上这样的数字串呢？于是，DNS服务应运而生，用户只需输入一个贴近自然语言的网址，DNS就能将请求带向IP拥有者的网站去。</p>
                    </div>
                </div>
                <div>
                    <h3 style="padding-top: 10px">原理</h3>
                    <hr>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;DNS是Domain Name System的缩写，直译作\"域名系统\"。它好似一个翻译，告诉他自然语言表示的域名，它就能帮你翻译成机器识别的IP。</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;具体而言，DNS的工作流程涉及到的实体有两个：DNS服务端和客户端，整个过程可概括为五步：</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;1 集成在终端（比如PC、Mac、手机等）的DNS客户端服务会在操作系统运行时启动待命。</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;2 系统应用（比如浏览器）在访问网站前，会截取捕获到的URL的域名部分，发送给DNS客户端</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;3 DNS客户端检查路由层缓存，若能查询到相应结果则直接返回，否则将发送过来的的域名包装成查询报文，然后通过UDP方式自端口53发送到DNS服务器</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;4 DNS服务器收到请求后，查询服务商的DNS缓存（比如中国电信的DNS缓存），若有结果则直接返回</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;5 若ISP缓存中查不到时，DNS服务器进行映射解析，并将包含主机IP的解析结果返回给DNS客户端</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;6 DNS客户端将主机地址返回给系统应用，系统应用向指定IP发起TCP连接</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;值得一提的是，在应用程序将域名发送给DNS客户端之前，它会先检查自己和操作系统的地址缓存，再搜索操作系统地址映射文件（比如host文件），若都查不到结果，再进行后续操作。</p>
                    </div>
                    <img src="/page/tech/blog/blog-3/dns-cluster.jpg" width="720px" alt="blog3"/>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;上文第五步提到过一个名词：DNS映射解析，这个过程较为复杂，此处单独拎出来阐述一下。</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;在目前的互联网体系中，DNS服务被设计成了分布式集群，这样的设计不但能防止单点故障，还大大提升了DNS服务的整体性能。除此之外，不同的国家区域使用不同的DNS资源子网，也有利于降低远距离的时间延迟，方便了各区域机构对DNS信息的日常维护。</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;在DNS集群中，服务器分为三类：</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;I 根域名服务器</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;II 顶级域名服务器（一般用来区分领域：如识别教育机构的.edu、识别政府机构的.gov ）</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;III 主域名服务器（一般用来区分公认的注册机构主体，维护一个区域的所有域名映射）</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;他们之间有着不同的层级关系，最上层的是根域名服务器，然后是顶级域名和主域名服务器。为何要分层呢？主要是考虑到以下三点：</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;解耦：映射变动仅需修改自己的DNS，变化不会影响到它人。只要主机名经过上层合法的DNS服务器设定，就可以在Internet上面被查询到。这样的设计维护简单，灵活性也好</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;高效：每次查询到的结果都会储存在 DNS 服务器的高速缓存中，以方便若下次有相同需求的解析时，能够快速的响应</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;扩展：每级域名都可以向下授权，扩展出更多的子域名，扩充整个映射容量</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;基于这样的分布式层级集群设计，一次映射解析的详细流程是：</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;a 解析请求被发送到系统设置的本地DNS服务器（可以打开电脑中的网络设置查看本地DNS地址）</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;b 如果本地DNS服务器中能查到相应映射，则直接返回结果，否则查询本地DNS服务器的缓存
                        </p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;c 解析请求被发送到DNS集群中解析：</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;c-1 若本地DNS服务器未能查到结果，则根据转发策略将请求转发给指定DNS服务器进行解析，若指定服务器还不能解析，则按策略中定义的路由规则递归转发请求，直到完成解析</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;c-2 若本地DNS服务器未能查到结果，且未设置转发策略，则将请求转发给最上层的根域名服务器进行处理。根域名服务器根据域名的标识符，逐级向下转发，直到有服务器可以查询到结果。</p>
                    </div>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;d 返回解析结果给DNS客户端</p>
                    </div>
                    <img src="/page/tech/blog/blog-3/dns-process.jpg" width="720px" alt="blog3"/>
                    <div>
                        <p style="font-size: 14px">&nbsp;&nbsp;&nbsp;了解了DNS的工作原理后，若读者想进一步学习DNS，建议读者去Google一下DNS的一些实现细节，比如DNS协议的实现、路由策略等知识点。相信看完后对DNS的理解定能更上一层楼。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--END of blog section-->
</div>
</body>
<script type="application/javascript">
    $(function () {
        var navType = $("#navType").val();
        if (navType === "BLOG") {
            $("#nav-blog").addClass("selected").append(" -> ");
        } else if (navType === "NOTE") {
            $("#nav-note").addClass("selected").append(" -> ");

        } else if (navType === "FAQ") {
            $("#nav-fq").addClass("selected").append(" -> ");

        } else if (navType === "DIGEST") {
            $("#nav-digest").addClass("selected").append(" -> ");

        }
    });
</script>
</html>