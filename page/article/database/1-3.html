<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <!-- title -->
    <title>王贤兑的技术博客</title>

    <!-- meta -->
    <meta charset="UTF-8">

    <!-- links -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../../css/style.css">

    <!-- scripts -->

    <!-- IE Hacks -->
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body class="home blog">

<!-- header -->
<header>
    <div id="light">
        <div class="container_16">
            <h1 class="grid_8" style="font-size: 45px"><a href="../../../index.html">Code Craft Of XD.Wang</a></h1>
            <nav class="grid_8">
                <ul id="menu-menu" class="menu">
                    <li><a href="../../../index.html">主页</a></li>
                    <li><a href="../../../page/list/blog.html">博客</a></li>
                    <li><a href="../../../page/list/me.html">ME</a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>
<div class="copyrights">作者：王贤兑</div>

<!-- wrapper -->
<div id="wrapper">
    <div class="container_16">
        <section id="posts" class="prefix_1 grid_9">

            <article>
                <h2>IDEA 技巧指南</h2>
                <p class="info">February 10th, 2017 | by <span><a href="#" rel="author">XD.Wang</a></span> | database
                </p>
                <div class="time"><p>Feb<br><span>10</span></p></div>

                <p></p>

                <div class="text">
                    <p><img src="../../../images/article/database/1-1.png" height="200" width="500"></p>

                    <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当MySql单表记录达一亿以上时，不当的数据操作可能引起较为严重的性能问题。针对具体问
                        题进行有效的性能优化，是每个Java工程师必须具备的能力。</p>
                    <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在做性能分析前，需要先明确具体业务场景是什么，不同的业务场景需要制定不同的解决方案。了解业务首先得了解数据，比如说：
                    <ul>
                        <li>数据库的QPS是多少；</li>
                        <li>读写比是怎样的情况；</li>
                        <li>数据增长速率如何；</li>
                        <li>最初的表设计是什么样的；</li>
                        <li>有影响的sql语句；</li>
                        <li>数据和相关的架构在一致性、高可用等方面有何要求；</li>
                    </ul>

                    <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;明确了业务场景后，制定优化方案可从五个方向考虑：SQL优化、索引优化、缓存、读写分离、切分。</p>

                    <h4>1. S Q L 优化：</h4>
                    <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;很多场景中，只通过修改不合理的SQL语句，就能达到预期的优化效果。常见的SQL问题包括：</p>
                    <ul>
                        <li>join操作：有些情况下，join操作完全可以放在代码中实现，在内存消耗可接受的情况下，没必要在数据库中join</li>
                        <li>where中null值判断：这种操作无法使用索引，可用某个特殊值表示null值，比如-1</li>
                        <li>where中的比较操作：!=、>、< 操作无法使用索引</li>
                        <li>where中的or操作：or无法使用索引</li>
                        <li>in和not in的操作：此类操作会导致全表扫描，当候选值连续时，可通过between代替，还有少数场景可以考虑使用exist，具体
                            情况具体分析
                        </li>
                        <li>模糊查找：此类操作会导致全表扫描</li>
                        <li>表达式：where子句中，条件值为表达式会导致全表扫描</li>
                        <li>函数操作：where子句中，条件值为函数操作会导致全表扫描</li>
                        <li>列操作：列操作将导致全表扫描</li>
                    </ul>
                    <h4>2. 索引优化：</h4>
                    <ul>
                        <li>多数程序员都会为频繁查询的字段添加索引，但随着业务的变化，某些当初不必建立索引的字段可能如今也得添加索引。使用explain
                            关键字分析问题语句，跟踪索引的使用情况，添加必要的索引
                        </li>
                        <li>了解复合索引的工作方式，添加或剔除不合业务场景的符合索引</li>
                        <li>若某字段只有少数可能的值，不要为该字段添加索引</li>
                        <li>避免更新聚集索引</li>
                        <li>insert和update操作可能会重建索引，若索引太多，不但会降低磁盘效率，占据大量空间，还会减慢这两种操作的速度</li>
                    </ul>
                    <h4>3. 应用缓存：</h4>
                    <p>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用redis分担数据库的压力，处理某些热点读
                    </p>
                    <h4>4. 读写分离：</h4>
                    <ul>
                        <li>主从复制：主写从读。主服务器将更新的数据记录在二进制日志（Binary Log）中，每次记录称作一个Binary Log Event；
                            从库将Binary Log Event拷贝到自己的中继日志（Relay Log）中；从库执行拷贝来的Event，以更新从库数据；
                        </li>
                        <li>主主复制：相对写读。每台服务器的变化都会同步到另一台服务器上；（无法做性能优化，用于灾备）</li>
                        <li>使用中间件：比如奇虎的Atlas</li>
                    </ul>
                    <h4>5. 切分：</h4>
                    <ul>
                        <li>
                            架构
                            <ul>
                                <li>垂直切分：将一个大的系统纵向切分为一个个小的系统，协调各业务的资源占用，做成分布式架构</li>
                                <li>水平切分：解除单机资源限制</li>
                            </ul>
                        </li>
                        <li>
                            策略
                            <ul>
                                <li>分库：分库可以提高数据库的并发读写能力，当并发过高导致性能下降时，可以考虑分库</li>
                                <li>分表：垂直分表（原表行结构不变）。将表中频繁更改的字段分离到另一张表中，通过主键和原表关联；水平分表（原表列
                                    结构不变）。将表中的数据根据业务场景、或既定策略（比如时间、哈希取余、增量等）分至不同的表中，水平分表可以有效减少
                                    表的数据量，减少查询时对数据和索引的遍历；
                                </li>
                                <li>分区：略</li>
                            </ul>
                        </li>
                    </ul>
                    <h4>6. 其他：</h4>
                    <ul>
                        <li>引擎选择：两大引擎Innodb和MyIsam各自各自的特点，前者锁的粒度更小，适合读写比均衡或写多读少的情况，后者则适合读多写少的情况</li>
                        <li>事务：合理使用事务，提高数据库并发能力</li>
                        <li>OPTIMIZE TABLE：OPTIMIZE TABLE可以用来处理文件碎片，提高数据库性能</li>
                    </ul>

                    <!--<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Java是一门面向对象编程语言，不仅吸收了C++语言的各种优点，还摒弃了C++里难以理解的-->
                    <!--多继承、指针等概念，因此Java语言具有功能强大和简单易用两个特征。Java语言作为静态面向对象编程语言的代表，极好地实现了面-->
                    <!--向对象理论，允许程序员以优雅的思维方式进行复杂的编程[1]。-->
                    <!--Java具有简单性、面向对象、分布式、健壮性、安全性、平台独立与可移植性、多线程、动态性等特点[2] 。Java可以编写桌面应用-->
                    <!--程序、Web应用程序、分布式系统和嵌入式系统应用程序等[3] 。</p>-->
                </div>
                <div class="clear"></div>
            </article>

        </section>

        <aside class="prefix_1 grid_5">

            <!-- Categories-->
            <h4>Categories</h4>
            <ul class="categories">
                <li><a href="../../../page/list/lang.html">语言</a></li>
                <li><a href="../../../page/list/algorithm.html">算法</a></li>
                <li><a href="../../../page/list/framework.html">框架</a></li>
                <li><a href="../../../page/list/database.html">数据库</a></li>
                <li><a href="../../../page/list/arch.html">架构</a></li>
                <li><a href="../../../page/list/jvm.html">虚拟机</a></li>
                <li><a href="../../../page/list/bigdata.html">大数据</a></li>
                <li><a href="../../../page/list/tool.html">工具</a></li>
            </ul>
            <div class="clear"></div>
            <hr>

            <!-- article -->
            <h4>Articles</h4>
            <ul class="blogroll">
                <li><a href="../../../page/article/database/1-1.html">MySql性能优化</a></li>
                <li><a href="../../../page/article/database/1-2.html">Binary Log简介</a></li>
                <li><a href="../../../page/article/arch/1-1.html">分布式服务框架概述</a></li>
                <li><a href="../../../page/article/arch/1-2.html">通信框架设计：技术选型和可靠性</a></li>
                <li><a href="../../../page/article/bigdata/1-1.html">Spark快速入门</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
            </ul>
            <hr>

        </aside>
    </div>
</div>

<!-- footer -->
<footer>
    <section id="footer_content">
        <div class="container_12">

        </div>
    </section>
    <section id="powered">
        <div class="container_12">
            <p class="grid_10"> code craft by <a href="https://lucifiere.github.io/"
                                                 title="王贤兑的博客" target="_blank"> XD.Wang </a></p>
            <p class="grid_2"><a class="top" href="#">▲ Back to top</a></p>
        </div>
    </section>
</footer>
</body>
</html>