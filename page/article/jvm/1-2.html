<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <!-- title -->
    <title>王贤兑的技术博客</title>

    <!-- meta -->
    <meta charset="UTF-8">

    <!-- links -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../../css/style.css">

    <!-- scripts -->

    <!-- IE Hacks -->
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body class="home blog">

<!-- header -->
<header>
    <div id="light">
        <div class="container_16">
            <h1 class="grid_8" style="font-size: 45px"><a href="../../../index.html">Code Craft Of XD.Wang</a></h1>
            <nav class="grid_8">
                <ul id="menu-menu" class="menu">
                    <li><a href="../../../index.html">主页</a></li>
                    <li><a href="../../../page/list/blog.html">博客</a></li>
                    <li><a href="../../../page/list/me.html">ME</a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>
<div class="copyrights">作者：王贤兑</div>

<!-- wrapper -->
<div id="wrapper">
    <div class="container_16">
        <section id="posts" class="prefix_1 grid_9">

            <article>
                <h2>Java关键字实现原理</h2>
                <p class="info">March 20th, 2017 | by <span><a href="#" rel="author">XD.Wang</a></span> | jvm
                </p>
                <div class="time"><p>Mar<br><span>13</span></p></div>

                <div class="text">
                    <p><img src="../../../images/article/jvm/1-1.jpg" height="250" width="510"></p>
                    <h4>Synchronized</h4>
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized关键字是设计高并发程序时最常用的策略之一，它的作用主要包括：</p>
                    <ul>
                        <li>保证代码被各线程互斥的访问</li>
                        <li>避免代码受到指令重排的影响</li>
                        <li>保证变量的更新能立即反映到主存</li>
                    </ul>
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronized作用的代码块在编译为字节码后，会生成monitorenter和monitorexit指令，
                        以保证范围内的代码可以同步执行。从底层来看，Java中每个对象都有一个监视器锁，当该锁计数器为0时，允许一个线程占用该锁，
                        并将计数器值加一，当该线程释放锁时，计数器会减一，从而使其他线程有机会获取监视器锁。当synchronized作用于方法时，
                        会为方法生成一个ACC_SYNCHRONIZED常量，当线程检测到该常量时，会先尝试获取该方法所在对象的监视器锁，若获取成功则执行方法。
                    </p>

                    <h4>Volatile</h4>
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volatile是一种轻量级的同步机制，它的作用主要包括：</p>
                    <ul>
                        <li>保证变量的改变可以及时反映到主存中，对其他线程立即可见</li>
                        <li>阻止指令重排</li>
                    </ul>
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从机器码级别分析，volatile修饰的变量在被赋值后，会执行一个lock操作
                        (lock addl $ 0x0, (esp)），这个操作就像是一个内存屏障，会阻止屏障后面的指令被重排序到屏障之前，从而实现阻止指令重排的效果。
                    </p>
                    <ul>
                        <li><b>tip:&nbsp;&nbsp;</b>lock操作可以使本CPU的cache写入内存，并使其他CPU的cache无效化。</li>
                    </ul>
                    <p>
                        从语义来看，这个lock操作的含义是是将ESP寄存器的值加0，显然这并没有什么业务意义，但它会触发一次写入到内存的操作，
                        从而实现其他线程立即可见的效果。
                    </p>

                </div>
                <div class="clear"></div>
            </article>

        </section>

        <aside class="prefix_1 grid_5">

            <!-- Categories-->
            <h4>Categories</h4>
            <ul class="categories">
                <li><a href="../../../page/list/lang.html">语言</a></li>
                <li><a href="../../../page/list/algorithm.html">算法</a></li>
                <li><a href="../../../page/list/framework.html">框架</a></li>
                <li><a href="../../../page/list/database.html">数据库</a></li>
                <li><a href="../../../page/list/arch.html">架构</a></li>
                <li><a href="../../../page/list/jvm.html">虚拟机</a></li>
                <li><a href="../../../page/list/bigdata.html">大数据</a></li>
                <li><a href="../../../page/list/tool.html">工具</a></li>
            </ul>
            <div class="clear"></div>
            <hr>

            <!-- article -->
            <h4>Articles</h4>
            <ul class="blogroll">
                <li><a href="../../../page/article/database/1-1.html">MySql性能优化</a></li>
                <li><a href="../../../page/article/database/1-2.html">Binary Log简介</a></li>
                <li><a href="../../../page/article/arch/1-1.html">分布式服务框架概述</a></li>
                <li><a href="../../../page/article/arch/1-2.html">通信框架设计：技术选型和可靠性</a></li>
                <li><a href="../../../page/article/bigdata/1-1.html">Spark快速入门</a></li>
                <li><a href="../../../page/article/jvm/1-1.html">JVM基础知识概述</a></li>
                <li><a href="../../../page/article/lang/1-2.html">理解Java线程池</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
                <li><a href="#">最近发布</a></li>
            </ul>
            <hr>

        </aside>
    </div>
</div>

<!-- footer -->
<footer>
    <section id="footer_content">
        <div class="container_12">

        </div>
    </section>
    <section id="powered">
        <div class="container_12">
            <p class="grid_10"> code craft by <a href="https://lucifiere.github.io/"
                                                 title="王贤兑的博客" target="_blank"> XD.Wang </a></p>
            <p class="grid_2"><a class="top" href="#">▲ Back to top</a></p>
        </div>
    </section>
</footer>
</body>
</html>